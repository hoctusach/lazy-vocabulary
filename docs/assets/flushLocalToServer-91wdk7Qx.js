var g=(e,s,r)=>new Promise((o,a)=>{var l=u=>{try{f(r.next(u))}catch(_){a(_)}},t=u=>{try{f(r.throw(u))}catch(_){a(_)}},f=u=>u.done?o(u.value):Promise.resolve(u.value).then(l,t);f((r=r.apply(e,s)).next())});import{upsertProgress as b}from"./pushers-CK5QM_Sy.js";import"./index-D6GaLcQm.js";import"./ui-BKbdfWl9.js";import"./vendor-BCuAxY6N.js";const S=3e4;let m=0;const p=3;function h(e){if(!e)return!1;if(e.isLearned===!0||typeof e.status=="string"&&["learned","mastered"].includes(e.status.toLowerCase())||typeof e.status=="number"&&e.status>=3)return!0;const s=typeof e.review_count=="number"?e.review_count:typeof e.reviewCount=="number"?e.reviewCount:typeof e.count=="number"?e.count:null;return s!==null&&s>=p}function L(){var s,r;const e=[];try{const o=localStorage.getItem("learningProgress");if(o){const a=JSON.parse(o);for(const[l,t]of Object.entries(a))h(t)&&e.push({word_key:l,learned_at:new Date().toISOString(),status:(s=t.status)!=null?s:null,review_count:typeof t.review_count=="number"?t.review_count:typeof t.reviewCount=="number"?t.reviewCount:typeof t.count=="number"?t.count:void 0})}}catch(o){}try{if(e.length===0){const o=localStorage.getItem("vocabulary-word-counts");if(o){const a=JSON.parse(o);for(const[l,t]of Object.entries(a))((r=t==null?void 0:t.count)!=null?r:0)>=p&&e.push({word_key:l,learned_at:new Date().toISOString(),review_count:t.count})}}}catch(o){}return e}function x(e){return g(this,null,function*(){var a,l,t,f,u,_,d,v,y;const s=Date.now();if(s-m<S)return;m=s;const r=[];try{const w=localStorage.getItem("learningProgress");if(w){const n=JSON.parse(w);for(const[c,i]of Object.entries(n))r.push({word_key:c,category:(a=i.category)!=null?a:null,status:(l=i.status)!=null?l:null,review_count:typeof i.reviewCount=="number"?i.reviewCount:typeof i.review_count=="number"?i.review_count:void 0,next_review_at:(f=(t=i.nextReviewDate)!=null?t:i.next_review_at)!=null?f:null,learned_at:(u=i.learnedDate)!=null?u:null})}}catch(w){}const o=L();if(o.length){const w=new Map(r.map(n=>[n.word_key,n]));for(const n of o){const c=w.get(n.word_key);c?(c.learned_at=(_=c.learned_at)!=null?_:n.learned_at,c.review_count=(d=c.review_count)!=null?d:n.review_count,c.status==null&&(c.status=(v=n.status)!=null?v:3)):w.set(n.word_key,{word_key:n.word_key,learned_at:n.learned_at,review_count:n.review_count,status:(y=n.status)!=null?y:3})}r.length=0,r.push(...w.values())}r.length&&(yield b(e,r))})}export{x as flushLocalToServer};
