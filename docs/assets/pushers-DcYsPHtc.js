var g=Object.defineProperty;var d=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var k=(s,n,e)=>n in s?g(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e,l=(s,n)=>{for(var e in n||(n={}))h.call(n,e)&&k(s,e,n[e]);if(d)for(var e of d(n))w.call(n,e)&&k(s,e,n[e]);return s};var c=(s,n,e)=>new Promise((u,o)=>{var t=i=>{try{r(e.next(i))}catch(_){o(_)}},a=i=>{try{r(e.throw(i))}catch(_){o(_)}},r=i=>i.done?u(i.value):Promise.resolve(i.value).then(t,a);r((e=e.apply(s,n)).next())});import{g as y,e as f}from"./index-CpAeBKXR.js";import"./ui-BFstIHNx.js";import"./vendor-BCuAxY6N.js";const p=()=>({updated_at:new Date().toISOString()});function x(s,n){return c(this,null,function*(){const e=y();if(!e||n.length===0)return;const u=yield f();if(!u)return;const o=n.map(t=>{var a;return l({user_unique_key:u,category:t.category,last_word_key:t.last_word_key,last_seen_at:(a=t.last_seen_at)!=null?a:null},p())});return e.from("resume_state").upsert(o,{onConflict:"user_unique_key,category"})})}function v(s,n){return c(this,null,function*(){const e=y();if(!e||n.length===0)return;const u=yield f();if(!u)return;const o=n.map(t=>{var a,r,i,_,m;return l({user_unique_key:u,word_key:t.word_key,category:(a=t.category)!=null?a:null,status:(r=t.status)!=null?r:null,review_count:(i=t.review_count)!=null?i:null,next_review_at:(_=t.next_review_at)!=null?_:null,learned_at:(m=t.learned_at)!=null?m:null},p())});return e.from("learning_progress").upsert(o,{onConflict:"user_unique_key,word_key"})})}function M(s,n,e){return c(this,null,function*(){var r;const u=y();if(!u)return;const o=yield f();if(!o)return;const t=(r=n==null?void 0:n.slice(0,10))!=null?r:null;if(!t||!e)return;const a=l({user_unique_key:o,selection_date:t,selection_json:e},p());return u.from("daily_selection").upsert(a,{onConflict:"user_unique_key,selection_date"})})}function T(s,n){return c(this,null,function*(){const e=y();if(!e||n.length===0)return;const u=yield f();if(!u)return;const o=n.map(t=>{var a,r,i;return l({user_unique_key:u,day_iso:(r=(a=t.dayISO)==null?void 0:a.slice(0,10))!=null?r:null,duration_ms:Math.max(0,Math.floor((i=t.duration_ms)!=null?i:0))},p())}).filter(t=>t.day_iso);if(o.length)return e.from("learning_time").upsert(o,{onConflict:"user_unique_key,day_iso"})})}function A(s,n){return c(this,null,function*(){const e=y();if(!e||n.length===0)return;const u=yield f();if(!u)return;const o=n.map(t=>{var a,r;return l({user_unique_key:u,word_key:t.word_key,count:Math.max(0,Math.floor((a=t.count)!=null?a:0)),last_shown_at:(r=t.last_shown_at)!=null?r:null},p())});return e.from("word_counts").upsert(o,{onConflict:"user_unique_key,word_key"})})}export{M as upsertDailySelection,T as upsertLearningTime,v as upsertProgress,x as upsertResume,A as upsertWordCounts};
